version: "3.9"

services:
  # Using Linux router instead of pfSense for container compatibility
  firewall:
    build:
      context: ./firewall
    container_name: firewall
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      - wan_net
      - lan_net
      - dmz_net
    volumes:
      #- ./suricata-etc:/etc/suricata
      - ./suricata-logs:/var/log/suricata
    sysctls:
      net.ipv4.ip_forward: "1"
    restart: unless-stopped

  dmz-web:
    image: nginx:alpine
    container_name: dmz-web
    cap_add:
      - NET_ADMIN
    networks:
      dmz_net:
        ipv4_address: 10.100.2.10
    volumes:
      - ./web-content:/usr/share/nginx/html

  lan-client:
    image: alpine:latest
    container_name: lan-client
    cap_add:
      - NET_ADMIN
    networks:
      lan_net:
        ipv4_address: 10.100.1.100
    command: ["sh", "-c", "apk add --no-cache curl iproute2 && tail -f /dev/null"]

  attacker:
    image: alpine:latest
    container_name: attacker
    cap_add:
      - NET_ADMIN
    networks:
      wan_net:
        ipv4_address: 10.100.0.10
    command: ["sh", "-c", "apk add --no-cache curl nmap iproute2 && tail -f /dev/null"]

networks:
  wan_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.100.0.0/24
  lan_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.100.1.0/24
  dmz_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.100.2.0/24
